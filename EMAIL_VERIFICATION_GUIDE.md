# üìß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Email –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ - BeauTips

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email –¥–ª—è BeauTips.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SMTP](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-smtp)
4. [–ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–º–∏–≥—Ä–∞—Ü–∏—è-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
5. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
6. [Troubleshooting](#troubleshooting)
7. [API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

---

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –¢–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ email –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ **UX**: –ö—Ä–∞—Å–∏–≤—ã–µ –ø–∏—Å—å–º–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –¢–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ (24 —á–∞—Å–∞)
- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å–µ–º

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è
   ‚Üì
2. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç –∞–∫–∫–∞—É–Ω—Ç —Å email_verified = FALSE
   ‚Üì
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–∏—Å—å–º–æ —Å —Ç–æ–∫–µ–Ω–æ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
   ‚Üì
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —Å—Å—ã–ª–∫—É –≤ –ø–∏—Å—å–º–µ
   ‚Üì
5. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è verify-email.html
   ‚Üì
6. Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è (email_verified = TRUE)
   ‚Üì
7. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ
   ‚Üì
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
```

**–ë–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email ‚Üí –≤—Ö–æ–¥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω** ‚ùå

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```bash
cd backend
pip install -r requirements.txt
```

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ `requirements.txt`:
- `python-dotenv` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å .env —Ñ–∞–π–ª–∞–º–∏
- `email-validator` - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `smtplib` - –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞:
```bash
cp backend/.env.example backend/.env
```

2. –û—Ç–∫—Ä–æ–π—Ç–µ `backend/.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–º. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SMTP](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-smtp))

### –®–∞–≥ 3: –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql -U your_username -d beautips_db

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
\i backend/migrations/add_email_verification.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Python:

```python
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª migrate.py
import asyncio
from sqlalchemy import text
from database import engine

async def migrate():
    async with engine.begin() as conn:
        with open('backend/migrations/add_email_verification.sql', 'r') as f:
            sql = f.read()
            # –£–¥–∞–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º
            statements = [s.strip() for s in sql.split(';') if s.strip() and not s.strip().startswith('--')]
            for statement in statements:
                if statement:
                    await conn.execute(text(statement))
        await conn.commit()
    print("‚úÖ Migration completed!")

asyncio.run(migrate())
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
cd backend
python -m uvicorn main:app --reload
```

---

## üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SMTP

### Gmail (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

1. **–í–∫–ª—é—á–∏—Ç–µ 2FA** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Google –∞–∫–∫–∞—É–Ω—Ç–∞:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://myaccount.google.com/security
   - –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

2. **–°–æ–∑–¥–∞–π—Ç–µ App Password**:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://myaccount.google.com/apppasswords
   - –í—ã–±–µ—Ä–∏—Ç–µ "–ü–æ—á—Ç–∞" –∏ "–î—Ä—É–≥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
   - –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: "BeauTips"
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ 16-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env**:
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=xxxx xxxx xxxx xxxx  # 16-—Å–∏–º–≤–æ–ª—å–Ω—ã–π App Password
FROM_EMAIL=your-email@gmail.com
FROM_NAME=BeauTips
BASE_URL=http://localhost:8000
```

### –Ø–Ω–¥–µ–∫—Å –ü–æ—á—Ç–∞

1. **–í–∫–ª—é—á–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://id.yandex.ru/security
   - –í–∫–ª—é—á–∏—Ç–µ "–ü–∞—Ä–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
   - –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è "–ü–æ—á—Ç–∞"

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env**:
```env
SMTP_HOST=smtp.yandex.ru
SMTP_PORT=465
SMTP_USER=your-email@yandex.ru
SMTP_PASSWORD=your-app-password
FROM_EMAIL=your-email@yandex.ru
FROM_NAME=BeauTips
BASE_URL=http://localhost:8000
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–ª—è –Ø–Ω–¥–µ–∫—Å –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSL –≤–º–µ—Å—Ç–æ STARTTLS. –ï—Å–ª–∏ –ø–æ—Ä—Ç 465 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ 587.

### Mail.ru

1. **–í–∫–ª—é—á–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://id.mail.ru/profile
   - –í–∫–ª—é—á–∏—Ç–µ "–ü–∞—Ä–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
   - –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è "–ü–æ—á—Ç–∞"

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env**:
```env
SMTP_HOST=smtp.mail.ru
SMTP_PORT=465
SMTP_USER=your-email@mail.ru
SMTP_PASSWORD=your-app-password
FROM_EMAIL=your-email@mail.ru
FROM_NAME=BeauTips
BASE_URL=http://localhost:8000
```

### –î—Ä—É–≥–∏–µ SMTP —Å–µ—Ä–≤–µ—Ä—ã

–î–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (SendGrid, Mailgun, AWS SES –∏ —Ç.–¥.) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:
- SMTP_HOST
- SMTP_PORT
- SMTP_USER (–æ–±—ã—á–Ω–æ API –∫–ª—é—á)
- SMTP_PASSWORD (–æ–±—ã—á–Ω–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)

---

## üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è:

1. **–ü–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `users`**:
   - `email_verified` (BOOLEAN) - —Ñ–ª–∞–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - `verification_token` (VARCHAR(255)) - —Ç–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - `verification_token_expires` (TIMESTAMP) - —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞

2. **–ò–Ω–¥–µ–∫—Å—ã**:
   - `idx_users_verification_token` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–æ–∫–µ–Ω—É
   - `idx_users_email_verified` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π
SELECT column_name, data_type 
FROM information_schema.columns
WHERE table_name = 'users' 
  AND column_name IN ('email_verified', 'verification_token', 'verification_token_expires');

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–¥–µ–∫—Å—ã
SELECT indexname 
FROM pg_indexes
WHERE tablename = 'users' 
  AND indexname LIKE '%verification%';
```

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

```sql
DROP INDEX IF EXISTS idx_users_verification_token;
DROP INDEX IF EXISTS idx_users_email_verified;
ALTER TABLE users 
DROP COLUMN IF EXISTS email_verified,
DROP COLUMN IF EXISTS verification_token,
DROP COLUMN IF EXISTS verification_token_expires;
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞

```bash
curl -X POST "http://localhost:8000/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "username": "testuser",
    "password": "testpass123"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –°—Ç–∞—Ç—É—Å 201 Created
- ‚úÖ –ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ test@example.com
- ‚úÖ –í –ë–î: `email_verified = FALSE`

### –¢–µ—Å—Ç 2: –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

```bash
curl -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "testpass123"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚ùå –°—Ç–∞—Ç—É—Å 403 Forbidden
- ‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ: "Please verify your email before logging in"

### –¢–µ—Å—Ç 3: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∏—Å—å–º–æ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ —Å—Å—ã–ª–∫–∏
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –ë–î:

```sql
SELECT verification_token FROM users WHERE email = 'test@example.com';
```

3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é:

```bash
curl -X POST "http://localhost:8000/api/auth/verify-email?token=YOUR_TOKEN_HERE"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –°—Ç–∞—Ç—É—Å 200 OK
- ‚úÖ `email_verified = TRUE` –≤ –ë–î
- ‚úÖ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

### –¢–µ—Å—Ç 4: –í—Ö–æ–¥ –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

```bash
curl -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "testpass123"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –°—Ç–∞—Ç—É—Å 200 OK
- ‚úÖ –ü–æ–ª—É—á–µ–Ω access_token

### –¢–µ—Å—Ç 5: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞

```bash
curl -X POST "http://localhost:8000/api/auth/resend-verification" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –°—Ç–∞—Ç—É—Å 200 OK
- ‚úÖ –ù–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ –ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ –ë–î

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:

1. –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8000/static/register.html
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É
4. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –≤ –ø–∏—Å—å–º–µ
5. –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
6. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–∏—Å—å–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP –≤ `.env`
2. –î–ª—è Gmail —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ App Password, –∞ –Ω–µ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Ñ–∞–π—Ä–≤–æ–ª–æ–º

**–õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**:
```python
# –í email_service.py –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
import logging
logger = logging.getLogger(__name__)

# –í –º–µ—Ç–æ–¥–µ send_verification_email:
logger.info(f"Attempting to send email to {to_email}")
logger.debug(f"SMTP settings: {self.smtp_host}:{self.smtp_port}")
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid verification token"

**–ü—Ä–∏—á–∏–Ω—ã**:
- –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ (24 —á–∞—Å–∞)
- –¢–æ–∫–µ–Ω —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω

**–†–µ—à–µ–Ω–∏–µ**:
- –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤–æ–µ –ø–∏—Å—å–º–æ —á–µ—Ä–µ–∑ `/api/auth/resend-verification`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑ URL

### –ü—Ä–æ–±–ª–µ–º–∞: "Please verify your email" –ø—Ä–∏ –≤—Ö–æ–¥–µ

**–ü—Ä–∏—á–∏–Ω–∞**: Email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email
2. –ò–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤–æ–µ –ø–∏—Å—å–º–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î: `SELECT email_verified FROM users WHERE email = '...'`

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–∏—Å—å–º–∞ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–ø–∞–º

**–†–µ—à–µ–Ω–∏–µ**:
1. –î–æ–±–∞–≤—å—Ç–µ SPF/DKIM –∑–∞–ø–∏—Å–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞ (–¥–ª—è production)
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π SMTP —Å–µ—Ä–≤–∏—Å (SendGrid, Mailgun)
3. –î–æ–±–∞–≤—å—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –≤ –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "Could not validate credentials"

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º–∞ —Å JWT —Ç–æ–∫–µ–Ω–æ–º –∏–ª–∏ get_current_user

**–†–µ—à–µ–Ω–∏–µ**:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `auth.py` `get_current_user` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç email –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ login —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–∫–µ–Ω —Å `sub: user.email`

---

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### POST `/api/auth/register`

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø–∏—Å—å–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**Request Body**:
```json
{
  "email": "user@example.com",
  "username": "username",
  "password": "password123"
}
```

**Response** (201 Created):
```json
{
  "id": 1,
  "email": "user@example.com",
  "username": "username",
  "phone": null,
  "is_active": true,
  "created_at": "2026-01-01T12:00:00Z",
  "email_verified": false
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –°–æ–∑–¥–∞—ë—Ç —Ç–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 24 —á–∞—Å–∞)
- `email_verified = FALSE` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

### POST `/api/auth/verify-email?token=...`

–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email –ø–æ —Ç–æ–∫–µ–Ω—É –∏–∑ –ø–∏—Å—å–º–∞.

**Query Parameters**:
- `token` (required) - —Ç–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ –ø–∏—Å—å–º–∞

**Response** (200 OK):
```json
{
  "success": true,
  "message": "Email verified successfully! You can now login.",
  "username": "username"
}
```

**–û—à–∏–±–∫–∏**:
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –∏—Å—Ç—ë–∫—à–∏–π —Ç–æ–∫–µ–Ω
- `500` - –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ
- –£–¥–∞–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–∑ –ë–î
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `email_verified = TRUE`

---

### POST `/api/auth/resend-verification`

–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**Request Body**:
```json
{
  "email": "user@example.com"
}
```

**Response** (200 OK):
```json
{
  "success": true,
  "message": "Verification email has been resent. Please check your inbox."
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
- –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ email (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- –ï—Å–ª–∏ email —É–∂–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 400

---

### POST `/api/auth/login`

–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π email).

**Request Body**:
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Response** (200 OK):
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "token_type": "bearer",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "username": "username",
    "email_verified": true
  }
}
```

**–û—à–∏–±–∫–∏**:
- `401` - –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å
- `403` - Email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω: "Please verify your email before logging in"
- `403` - –ê–∫–∫–∞—É–Ω—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- **–ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Ö–æ–¥** –µ—Å–ª–∏ `email_verified = FALSE`
- –°–æ–∑–¥–∞—ë—Ç JWT —Ç–æ–∫–µ–Ω —Å `sub: user.email`

---

## üé® Frontend –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: `verify-email.html`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ URL –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é.

**URL —Ñ–æ—Ä–º–∞—Ç**:
```
http://localhost:8000/static/verify-email.html?token=VERIFICATION_TOKEN
```

**–°–æ—Å—Ç–æ—è–Ω–∏—è**:
- ‚è≥ Loading - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
- ‚úÖ Success - email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
- ‚ùå Error - –æ—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚ö†Ô∏è No Token - —Ç–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∂–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

```javascript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
if (response.ok) {
  alert('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email.');
  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
  window.location.href = '/static/register.html';
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "Email not verified" –ø—Ä–∏ –≤—Ö–æ–¥–µ

```javascript
// –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ login
if (response.status === 403 && data.detail.includes('verify')) {
  const resend = confirm('–í–∞—à email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ —Å–Ω–æ–≤–∞?');
  if (resend) {
    // –í—ã–∑–≤–∞—Ç—å resend-verification
    await fetch('/api/auth/resend-verification', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: email })
    });
  }
}
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–æ–∫–µ–Ω—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

- ‚úÖ **256-bit —Ç–æ–∫–µ–Ω—ã** (32 –±–∞–π—Ç–∞, URL-safe)
- ‚úÖ **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ** (—É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- ‚úÖ **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è** (24 —á–∞—Å–∞)
- ‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ** (secrets.token_urlsafe)

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

- ‚úÖ **Rate limiting** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å)
- ‚úÖ **–ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ email** –≤ resend
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤** –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ **HTTPS –≤ production** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **HTTPS** –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. –î–æ–±–∞–≤—å—Ç–µ **rate limiting** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ FastAPI-limiter)
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π SMTP —Å–µ—Ä–≤–∏—Å** (SendGrid, Mailgun)
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ **SPF/DKIM** –∑–∞–ø–∏—Å–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
5. –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
6. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ –∏—Å—Ç—ë–∫—à–∏–µ —Ç–æ–∫–µ–Ω—ã

---

## üìù –ß–µ–∫–ª–∏—Å—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`pip install -r requirements.txt`)
- [ ] `.env` —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω
- [ ] SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] SQL –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- [ ] –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–π–¥–µ–Ω
- [ ] –ü–∏—Å—å–º–æ –ø–æ–ª—É—á–µ–Ω–æ –∏ –æ—Ç–∫—Ä—ã—Ç–æ
- [ ] –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Ö–æ–¥ –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –∫–æ–¥ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –ø—Ä–æ–µ–∫—Ç–∞ BeauTips.

---

**–ì–æ—Ç–æ–≤–æ! üéâ** –¢–µ–ø–µ—Ä—å —É –≤–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email!

